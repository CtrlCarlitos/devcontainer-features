# Dev Container Features

This repository provides a small set of Dev Container Features for AI tooling and developer ergonomics.

## Features

| Feature | Description | Min Node.js |
|---------|-------------|-------------|
| `node` | Installs Node.js via nvm | - |
| `claude-code` | Anthropic's Claude Code CLI | 18+ |
| `opencode` | OpenCode AI terminal agent | 18+ |
| `gemini-cli` | Google's Gemini CLI | 20+ |
| `bmad-method` | BMad Agile AI framework | 20+ |
| `codex` | OpenAI's Codex CLI | 22+ |
| `nerd-font` | Nerd Fonts (Meslo, etc.) | - |

## Node.js Version Requirements

The `node` feature defaults to **v22**, which satisfies all feature requirements:

```
node (default: 22)
    ├── codex (requires 22+) ✅
    ├── bmad-method (requires 20+) ✅
    ├── gemini-cli (requires 20+) ✅
    ├── claude-code (requires 18+) ✅
    └── opencode (requires 18+) ✅
```

Each feature validates its minimum Node.js version and fails with a helpful error if not met.

## Usage

### From GitHub Container Registry (recommended)

```json
{
  "features": {
    "ghcr.io/ctrlcarlitos/devcontainer-features/node:1": { "version": "22" },
    "ghcr.io/ctrlcarlitos/devcontainer-features/claude-code:1": {},
    "ghcr.io/ctrlcarlitos/devcontainer-features/codex:1": {},
    "ghcr.io/ctrlcarlitos/devcontainer-features/nerd-font:1": { "fonts": "Meslo,FiraCode" }
  }
}
```

### Local Development

```json
{
  "features": {
    "./src/node": { "version": "22" },
    "./src/claude-code": { "version": "latest" }
  }
}
```

## Testing

Run scenario tests with Dev Containers CLI:

```bash
npm install -g @devcontainers/cli
devcontainer features test --skip-autogenerated --project-folder .
```

## CI/CD

| Workflow | Trigger | Description |
|----------|---------|-------------|
| `test.yml` | Push to main, PRs | Runs feature tests |
| `publish.yml` | Tags `v*` | Publishes to GHCR |
| `auto-update.yml` | Daily 7AM UTC | Checks for upstream updates |

## Docker Volume Mounts for AI Tools

All AI tools (Claude Code, Codex, Gemini CLI, OpenCode) store authentication, configuration, and data that should persist across container rebuilds. See [DOCKER_VOLUMES.md](DOCKER_VOLUMES.md) for detailed volume mount configurations.

### Quick Reference

| Tool | Config Path | Data Path | Cache Path | # Volumes |
|-------|-------------|------------|--------------|--------------|
| OpenCode | `~/.config/opencode` | `~/.local/share/opencode` | `~/.cache/opencode` | 3 |
| Claude Code | `~/.claude/` | N/A | N/A | 1 |
| Codex | `~/.codex/` | `~/.local/share/codex/` | `~/.cache/codex/` | 3 |
| Gemini CLI | `~/.gemini/` | `~/.local/share/gemini-cli/` | `~/.cache/gemini-cli/` | 3 |

### Complete docker-compose.yml Example

Example with all AI tools configured:

```yaml
version: '3.8'
services:
  app:
    image: mcr.microsoft.com/devcontainers/base:ubuntu
    volumes:
      # Claude Code
      - claude_config:/home/vscode/.claude

      # Codex
      - codex_config:/home/vscode/.codex
      - codex_data:/home/vscode/.local/share/codex
      - codex_cache:/home/vscode/.cache/codex

      # Gemini CLI
      - gemini_config:/home/vscode/.gemini
      - gemini_data:/home/vscode/.local/share/gemini-cli
      - gemini_cache:/home/vscode/.cache/gemini-cli

      # OpenCode
      - opencode_config:/home/vscode/.config/opencode
      - opencode_data:/home/vscode/.local/share/opencode
      - opencode_cache:/home/vscode/.cache/opencode

      # Your workspace
      - .:/workspace

volumes:
  claude_config:
  codex_config:
  codex_data:
  codex_cache:
  gemini_config:
  gemini_data:
  gemini_cache:
  opencode_config:
  opencode_data:
  opencode_cache:
```

> **Note:** Replace `/home/vscode` with `/home/node` or `/root` if using a different user.

## License

MIT
